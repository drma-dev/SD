@using SD.Shared.Models.News;
@using System.Text.Json;
@inherits ComponentCore<NewsPopup>

@inject CacheFlixsterApi CacheFlixsterApi

<ModalHeader>
    <ModalTitle Size="HeadingSize.Is5">@($"{GlobalTranslations.NewsTitle} - Rotten Tomatoes")</ModalTitle>
    <CloseButton />
</ModalHeader>
<ModalBody MaxHeight="70">
    <RenderControl Core="Core" Model="News" ExpressionEmpty="@((NewsModel? obj) => obj == null || obj.Items.Empty())">
        <Row HorizontalGutter="4" VerticalGutter="4" Margin="Margin.Is1.FromBottom">
            @foreach (var item in News?.Items ?? new())
            {
                <Column ColumnSize="ColumnSize.Is6.OnMobile.Is4.OnWidescreen.Is3.OnFullHD">
                    <Card>
                        <CardImage Source="@item.url_img" Alt="@item.title">
                        </CardImage>
                        <CardBody>
                            <CardText Style="font-size: 0.8rem;">
                                @if (!string.IsNullOrEmpty(item.title))
                                {
                                    @((MarkupString)item.title)
                                }
                            </CardText>
                            <Button Color="Color.Primary" Type="ButtonType.Link" To="@item.link.HideExternalLink()" Target="Target.Blank" Size="Size.Small" Class="mt-2">
                                @GlobalTranslations.ButtonReadMore
                            </Button>
                        </CardBody>
                    </Card>
                </Column>
            }
        </Row>
    </RenderControl>
</ModalBody>
<ModalFooter>
    <Button Color="Color.Secondary" Clicked="@ModalService.Hide" Size="Size.Small">
        @TranslationText.Close
    </Button>
</ModalFooter>

@code {
    public RenderControlCore<NewsModel?> Core { get; set; } = new();
    private NewsModel? News { get; set; }
    public string? selectedSlide { get; set; }

    protected override async Task LoadDataRender()
    {
        News = await CacheFlixsterApi.GetNews("full", Core);
    }
}