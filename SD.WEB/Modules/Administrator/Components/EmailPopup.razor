@using SD.Shared.Models.Support
@using SD.WEB.Modules.Auth.Core
@using StrongGrid.Models
@inherits ComponenteCore<EmailPopup>

@inject AdministratorApi AdministratorApi

<ModalHeader>
    <ModalTitle Size="HeadingSize.Is5">
        @EmailDocument?.Subject
    </ModalTitle>
    <CloseButton />
</ModalHeader>
<ModalBody MaxHeight="70">
    @if (OnlyRead)
    {
        @((MarkupString)Html)
    }
    else
    {
     
    }
</ModalBody>
<ModalFooter>
    <Button Color="Color.Secondary" Clicked="@ModalService.Hide" Size="Size.Small">
        @TranslationText.Close
    </Button>
</ModalFooter>

@code {
    [Parameter] public EmailDocument? EmailDocument { get; set; }
    [Parameter] public bool OnlyRead { get; set; } = true;

    public string Html => EmailDocument?.Html ?? "";

    public async Task OnSave()
    {
        try
        {
            var inbound = new SendEmail();
            inbound.Html = "";

            await AdministratorApi.SendEmail(inbound);
        }
        catch (Exception ex)
        {
            ex.ProcessException(Toast, Logger);
        }
    }
}